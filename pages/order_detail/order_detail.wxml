<!--pages/order_detail/order_detail.wxml-->
<view class="container">  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <view class="header">
    <view class="back-btn" bindtap="goBack">
      <text class="back-icon">â—€</text>
    </view>
    <view class="back-text" bindtap="goBack">è¿”å›</view>
    <view class="title">è®¢å•è¯¦æƒ…</view>
  </view>
  
  <block wx:if="{{!loading && orderDetail}}">
    <!-- è®¢å•åŸºæœ¬ä¿¡æ¯ -->
    <view class="order-info-card">
      <view class="order-status">
        <view class="status-icon">âœ…</view>
        <view class="status-text">è®¢å•å·²å®Œæˆ</view>
      </view>
      <view class="order-id">è®¢å•å·ï¼š{{orderDetail.id}}</view>
      <view class="order-time">å®Œæˆæ—¶é—´ï¼š{{orderDetail.date}} {{orderDetail.time}}</view>
    </view>
    
    <!-- é…é€ä¿¡æ¯ -->
    <view class="section-card">
      <view class="section-title">é…é€ä¿¡æ¯</view>
      <view class="info-item">
        <view class="info-label">é…é€å‘˜ï¼š</view>
        <view class="info-value">å¼ å¸ˆå‚…ï¼ˆæ‚¨è‡ªå·±ï¼‰</view>
      </view>
      <view class="info-item">
        <view class="info-label">é…é€æ—¶é—´ï¼š</view>
        <view class="info-value">{{orderDetail.deliveryTime}}</view>
      </view>
      <view class="info-item">
        <view class="info-label">é…é€è·ç¦»ï¼š</view>
        <view class="info-value">{{orderDetail.distance}}</view>
      </view>
    </view>
    
    <!-- è®¢å•åœ°å€ä¿¡æ¯ -->
    <view class="section-card">
      <view class="section-title">åœ°å€ä¿¡æ¯</view>
      <view class="address-item">
        <view class="address-icon pickup">ğŸª</view>
        <view class="address-content">
          <view class="address-title">å–è´§åœ°ç‚¹</view>
          <view class="address-name">{{orderDetail.restaurant}}</view>
          <view class="address-detail">{{orderDetail.restaurantAddress}}</view>
        </view>
      </view>
      
      <view class="divider"></view>
      
      <view class="address-item">
        <view class="address-icon delivery">ğŸ </view>
        <view class="address-content">
          <view class="address-title">é€è´§åœ°ç‚¹</view>
          <view class="address-name">{{orderDetail.customer}} {{orderDetail.phone}}</view>
          <view class="address-detail">{{orderDetail.address}}</view>
        </view>
      </view>
    </view>
    
    <!-- è®¢å•å•†å“ -->
    <view class="section-card">
      <view class="section-title">è®¢å•å•†å“</view>
      <view class="product-list">
        <view class="product-item" wx:for="{{orderDetail.products}}" wx:key="name">
          <view class="product-name">{{item.name}}</view>
          <view class="product-info">
            <view class="product-price">Â¥{{item.price}}</view>
            <view class="product-count">x{{item.count}}</view>
          </view>
        </view>
      </view>
      <view class="order-amount">
        <view class="amount-label">è®¢å•é‡‘é¢ï¼š</view>
        <view class="amount-value">Â¥{{orderDetail.amount}}</view>
      </view>
      <view class="order-remark" wx:if="{{orderDetail.remark}}">
        <view class="remark-label">è®¢å•å¤‡æ³¨ï¼š</view>
        <view class="remark-value">{{orderDetail.remark}}</view>
      </view>
    </view>
    
    <!-- é…é€å‡­è¯ -->
    <view class="section-card">
      <view class="section-title">é…é€å‡­è¯</view>
      
      <!-- å›¾ç‰‡åŒºåŸŸ -->
      <view class="media-section">
        <view class="media-title">é…é€å›¾ç‰‡</view>
        <view class="image-list">
          <view class="image-item" wx:for="{{orderDetail.images}}" wx:key="*this" bindtap="previewImage" data-index="{{index}}">
            <image class="delivery-image" src="{{item}}" mode="aspectFill"></image>
          </view>
        </view>
      </view>
        <!-- è§†é¢‘åŒºåŸŸ -->
      <view class="media-section">
        <view class="media-title">é…é€è§†é¢‘</view>
        <view class="video-container" bindtap="previewVideo">
          <video 
            id="deliveryVideo" 
            class="delivery-video" 
            src="{{orderDetail.video}}" 
            binderror="videoError"
            show-center-play-btn="{{true}}"
            controls="{{true}}"
            object-fit="cover"
            poster="/images/delivery.png">
          </video>
          <view class="video-fullscreen-hint">
            <text class="hint-text">ç‚¹å‡»å…¨å±è§‚çœ‹</text>
          </view>
        </view>
      </view>
    </view>
    
    <!-- è®¢å•é…é€æµç¨‹ -->
    <view class="section-card">
      <view class="section-title">é…é€æµç¨‹</view>
      <view class="timeline">
        <view class="timeline-item" wx:for="{{orderDetail.timeline}}" wx:key="status">
          <view class="timeline-dot {{index === orderDetail.timeline.length - 1 ? 'active' : ''}}"></view>
          <view class="timeline-content">
            <view class="timeline-time">{{item.time}}</view>
            <view class="timeline-status">{{item.status}}</view>
          </view>
        </view>
      </view>
    </view>
  </block>
    <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-text">åŠ è½½ä¸­...</view>
  </view>
</view>

<!-- å…¨å±å›¾ç‰‡é¢„è§ˆ -->
<view class="fullscreen-media-container" wx:if="{{showFullScreenImage}}">
  <view class="fullscreen-header">
    <view class="back-btn" bindtap="backFromMediaPreview">
      <text class="back-icon">â†</text>
    </view>
    <view class="fullscreen-title">é…é€å›¾ç‰‡ {{currentImageIndex + 1}}/{{orderDetail.images.length}}</view>
  </view>
  
  <swiper class="fullscreen-swiper" current="{{currentImageIndex}}" bindchange="swiperChange">
    <swiper-item wx:for="{{orderDetail.images}}" wx:key="*this">
      <image class="fullscreen-image" src="{{item}}" mode="aspectFit"></image>
    </swiper-item>
  </swiper>
</view>

<!-- å…¨å±è§†é¢‘é¢„è§ˆ -->
<view class="fullscreen-media-container" wx:if="{{showFullScreenVideo}}">
  <view class="fullscreen-header">
    <view class="back-btn" bindtap="backFromMediaPreview">
      <text class="back-icon">â†</text>
    </view>
    <view class="fullscreen-title">é…é€è§†é¢‘</view>
  </view>
  
  <view class="fullscreen-video-container">
    <video 
      id="fullscreenVideo" 
      class="fullscreen-video" 
      src="{{orderDetail.video}}" 
      binderror="videoError"
      show-center-play-btn="{{true}}"
      controls="{{true}}"
      object-fit="contain"
      autoplay="{{true}}"
      poster="/images/delivery.png">
    </video>
  </view>
</view>
